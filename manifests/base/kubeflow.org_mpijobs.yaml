---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.14.0
  name: mpijobs.kubeflow.org
spec:
  group: kubeflow.org
  names:
    kind: MPIJob
    listKind: MPIJobList
    plural: mpijobs
    singular: mpijob
  scope: Namespaced
  versions:
  - name: v2beta1
    schema:
      openAPIV3Schema:
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            properties:
              launcherCreationPolicy:
                default: AtStartup
                description: launcherCreationPolicy if WaitForWorkersReady, the launcher
                  is created only after all workers are in Ready state. Defaults to
                  AtStartup.
                type: string
              mpiImplementation:
                default: OpenMPI
                description: |-
                  MPIImplementation is the MPI implementation.
                  Options are "OpenMPI" (default), "Intel" and "MPICH".
                enum:
                - OpenMPI
                - Intel
                - MPICH
                type: string
              mpiReplicaSpecs:
                additionalProperties:
                  description: ReplicaSpec is a description of the replica
                  properties:
                    replicas:
                      description: |-
                        Replicas is the desired number of replicas of the given template.
                        If unspecified, defaults to 1.
                      format: int32
                      type: integer
                    restartPolicy:
                      description: |-
                        Restart policy for all replicas within the job.
                        One of Always, OnFailure, Never and ExitCode.
                        Default to Never.
                      type: string
                    template:
                      $ref: '#/definitions/k8s.io~1api~1core~1v1~0PodTemplateSpec'
                      description: |-
                        Template is the object that describes the pod that
                        will be created for this replica. RestartPolicy in PodTemplateSpec
                        will be overide by RestartPolicy in ReplicaSpec
                  type: object
                description: |-
                  MPIReplicaSpecs contains maps from `MPIReplicaType` to `ReplicaSpec` that
                  specify the MPI replicas to run.
                type: object
              runLauncherAsWorker:
                default: false
                description: |-
                  RunLauncherAsWorker indicates whether to run worker process in launcher
                  Defaults to false.
                type: boolean
              runPolicy:
                description: RunPolicy encapsulates various runtime policies of the
                  job.
                properties:
                  activeDeadlineSeconds:
                    description: |-
                      Specifies the duration in seconds relative to the startTime that the job may be active
                      before the system tries to terminate it; value must be positive integer.
                    format: int64
                    type: integer
                  backoffLimit:
                    description: Optional number of retries before marking this job
                      failed.
                    format: int32
                    type: integer
                  cleanPodPolicy:
                    description: |-
                      CleanPodPolicy defines the policy to kill pods after the job completes.
                      Default to Running.
                    type: string
                  managedBy:
                    description: |-
                      ManagedBy is used to indicate the controller or entity that manages a MPIJob.
                      The value must be either empty, 'kubeflow.org/mpi-operator' or
                      'kueue.x-k8s.io/multikueue'.
                      The mpi-operator reconciles a MPIJob which doesn't have this
                      field at all or the field value is the reserved string
                      'kubeflow.org/mpi-operator', but delegates reconciling the MPIJob
                      with 'kueue.x-k8s.io/multikueue' to the Kueue.
                      The field is immutable.
                    type: string
                  schedulingPolicy:
                    description: SchedulingPolicy defines the policy related to scheduling,
                      e.g. gang-scheduling
                    properties:
                      minAvailable:
                        description: |-
                          MinAvailable defines the minimal number of member to run the PodGroup.
                          If the gang-scheduling isn't empty, input is passed to `.spec.minMember` in PodGroup.
                          Note that, when using this field,
                          you need to make sure the application supports resizing (e.g., Elastic Horovod).


                          If not set, it defaults to the number of workers.
                        format: int32
                        type: integer
                      minResources:
                        $ref: '#/definitions/k8s.io~1api~1core~1v1~0ResourceList'
                        description: |-
                          MinResources defines the minimal resources of members to run the PodGroup.
                          If the gang-scheduling isn't empty,
                          input is passed to `.spec.minResources` in PodGroup for scheduler-plugins.
                      priorityClass:
                        description: |-
                          PriorityClass defines the PodGroup's PriorityClass.
                          If the gang-scheduling is set to the volcano,
                          input is passed to `.spec.priorityClassName` in PodGroup for volcano,
                          and if it is set to the scheduler-plugins,
                          input isn't passed to PodGroup for scheduler-plugins.
                        type: string
                      queue:
                        description: |-
                          Queue defines the queue name to allocate resource for PodGroup.
                          If the gang-scheduling is set to the volcano,
                          input is passed to `.spec.queue` in PodGroup for the volcano,
                          and if it is set to the scheduler-plugins,
                          input isn't passed to PodGroup.
                        type: string
                      scheduleTimeoutSeconds:
                        description: |-
                          SchedulerTimeoutSeconds defines the maximal time of members to wait before run the PodGroup.
                          If the gang-scheduling is set to the scheduler-plugins,
                          input is passed to `.spec.scheduleTimeoutSeconds` in PodGroup for the scheduler-plugins,
                          and if it is set to the volcano, input isn't passed to PodGroup.
                        format: int32
                        type: integer
                    type: object
                  suspend:
                    default: false
                    description: |-
                      suspend specifies whether the MPIJob controller should create Pods or not.
                      If a MPIJob is created with suspend set to true, no Pods are created by
                      the MPIJob controller. If a MPIJob is suspended after creation (i.e. the
                      flag goes from false to true), the MPIJob controller will delete all
                      active Pods and PodGroups associated with this MPIJob. Also, it will suspend the
                      Launcher Job. Users must design their workload to gracefully handle this.
                      Suspending a Job will reset the StartTime field of the MPIJob.


                      Defaults to false.
                    type: boolean
                  ttlSecondsAfterFinished:
                    description: |-
                      TTLSecondsAfterFinished is the TTL to clean up jobs.
                      It may take extra ReconcilePeriod seconds for the cleanup, since
                      reconcile gets called periodically.
                      Default to infinite.
                    format: int32
                    type: integer
                type: object
              slotsPerWorker:
                default: 1
                description: |-
                  Specifies the number of slots per worker used in hostfile.
                  Defaults to 1.
                format: int32
                type: integer
              sshAuthMountPath:
                default: /root/.ssh
                description: |-
                  SSHAuthMountPath is the directory where SSH keys are mounted.
                  Defaults to "/root/.ssh".
                type: string
            required:
            - mpiReplicaSpecs
            type: object
          status:
            description: JobStatus represents the current observed state of the training
              Job.
            properties:
              completionTime:
                description: |-
                  Represents time when the job was completed. It is not guaranteed to
                  be set in happens-before order across separate operations.
                  It is represented in RFC3339 form and is in UTC.
                format: date-time
                type: string
              conditions:
                description: conditions is a list of current observed job conditions.
                items:
                  description: JobCondition describes the state of the job at a certain
                    point.
                  properties:
                    lastTransitionTime:
                      description: Last time the condition transitioned from one status
                        to another.
                      format: date-time
                      type: string
                    lastUpdateTime:
                      description: The last time this condition was updated.
                      format: date-time
                      type: string
                    message:
                      description: A human-readable message indicating details about
                        the transition.
                      type: string
                    reason:
                      description: The reason for the condition's last transition.
                      type: string
                    status:
                      $ref: '#/definitions/k8s.io~1api~1core~1v1~0ConditionStatus'
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                    type:
                      description: type of job condition.
                      type: string
                  required:
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              lastReconcileTime:
                description: |-
                  Represents last time when the job was reconciled. It is not guaranteed to
                  be set in happens-before order across separate operations.
                  It is represented in RFC3339 form and is in UTC.
                format: date-time
                type: string
              replicaStatuses:
                additionalProperties:
                  description: ReplicaStatus represents the current observed state
                    of the replica.
                  properties:
                    active:
                      description: The number of actively running pods.
                      format: int32
                      type: integer
                    failed:
                      description: The number of pods which reached phase failed.
                      format: int32
                      type: integer
                    labelSelector:
                      description: 'Deprecated: Use selector instead'
                      properties:
                        matchExpressions:
                          description: matchExpressions is a list of label selector
                            requirements. The requirements are ANDed.
                          items:
                            description: |-
                              A label selector requirement is a selector that contains values, a key, and an operator that
                              relates the key and values.
                            properties:
                              key:
                                description: key is the label key that the selector
                                  applies to.
                                type: string
                              operator:
                                description: |-
                                  operator represents a key's relationship to a set of values.
                                  Valid operators are In, NotIn, Exists and DoesNotExist.
                                type: string
                              values:
                                description: |-
                                  values is an array of string values. If the operator is In or NotIn,
                                  the values array must be non-empty. If the operator is Exists or DoesNotExist,
                                  the values array must be empty. This array is replaced during a strategic
                                  merge patch.
                                items:
                                  type: string
                                type: array
                                x-kubernetes-list-type: atomic
                            required:
                            - key
                            - operator
                            type: object
                          type: array
                          x-kubernetes-list-type: atomic
                        matchLabels:
                          additionalProperties:
                            type: string
                          description: |-
                            matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels
                            map is equivalent to an element of matchExpressions, whose key field is "key", the
                            operator is "In", and the values array contains only "value". The requirements are ANDed.
                          type: object
                      type: object
                      x-kubernetes-map-type: atomic
                    selector:
                      description: |-
                        A selector is a label query over a set of resources. The result of matchLabels and
                        matchExpressions are ANDed. An empty selector matches all objects. A null
                        selector matches no objects.
                      type: string
                    succeeded:
                      description: The number of pods which reached phase succeeded.
                      format: int32
                      type: integer
                  type: object
                description: |-
                  replicaStatuses is map of ReplicaType and ReplicaStatus,
                  specifies the status of each replica.
                type: object
              startTime:
                description: |-
                  Represents time when the job was acknowledged by the job controller.
                  It is not guaranteed to be set in happens-before order across separate operations.
                  It is represented in RFC3339 form and is in UTC.
                format: date-time
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
